@using DNSLab.Web.DTOs.Repositories.Bundle
@attribute [Route(AllRoutes.Bundle)]
<SeoProvider Title="پلن ها" Meta_Description="پلن های سایت DNSLab" />

<MudText Typo="Typo.h1" Align="Align.Center">تهیه اشتراک</MudText>
<MudText Class="mt-5" Align="Align.Center">
    همه‌چیز دست خودته — فقط همون چیزی رو بخر که واقعاً لازم داری!
    <MudFlexBreak />
    با سیستم قیمت‌گذاری منعطف DNSLab، دیگه لازم نیست برای امکاناتی که نمی‌خوای پول بدی. هر قابلیت رو جداگانه فعال کن، هزینه رو کنترل کن، و دقیقاً همون چیزی رو بساز که کارت رو راه می‌ندازه. سریع، ساده، اقتصادی.
</MudText>
<MudText Class="mt-5 mb-10">
    <MudStack Row AlignItems="AlignItems.Center" Justify="Justify.Center">
        اگه شرایط مالی‌ت سخت بود، بی‌خیال نشو! یه پیام بده، با هم حلش می‌کنیم ❤️ @("AkbarAsghari@") <MudIcon Icon="@DNSLabIcons.Telegram" Size="Size.Small" />
    </MudStack>
</MudText>
<MudCard Elevation="0">
    <MudCardContent>
        @if (_FeatureSections != null)
        {
            <MudGrid>
                @foreach (var sectionItem in _FeatureSections)
                {
                    <MudItem xs="12" md="6">
                        <MudPaper Class="pa-2" Outlined>
                            <MudText Typo="Typo.h2">@sectionItem.Name</MudText>
                            <MudText Typo="Typo.caption">@sectionItem.Description</MudText>
                            <MudDivider Class="my-2" />
                            @foreach (var item in sectionItem.Features.OrderBy(x => x.Order))
                            {
                                <MudPaper Class="mb-2 pa-2" Outlined>
                                    <MudStack Row AlignItems="AlignItems.Baseline" Justify="Justify.SpaceBetween" Spacing="10">

                                        <MudText>@item.Name</MudText>

                                        <MudStack Justify="Justify.SpaceAround">
                                            @switch (item.Type)
                                            {
                                                case Enums.FeatureTypeEnum.Toggle:
                                                    if (item.Pricing != null)
                                                    {
                                                        <MudStack Row AlignItems="AlignItems.Center">
                                                            <MudText Typo="Typo.caption">فعال سازی @((item.Pricing.ActivationPrice ?? 0).Separate3Digits()) ریال</MudText>
                                                            <MudSwitch Color="Color.Primary" T="bool" ValueChanged="(x)=> ToggleFeatureChanged(item, x)" />
                                                        </MudStack>

                                                    }
                                                    else
                                                    {
                                                        <MudStack Row AlignItems="AlignItems.Center">
                                                            <MudText Typo="Typo.caption">رایگان</MudText>
                                                        </MudStack>
                                                    }
                                                    break;
                                                case Enums.FeatureTypeEnum.Countable:
                                                    if (item.Pricing != null)
                                                    {
                                                        <MudStack Row AlignItems="AlignItems.Center">
                                                            <MudStack Spacing="0">
                                                                <MudText Typo="Typo.caption">هر عدد @((item.Pricing.UnitPrice ?? 0).Separate3Digits()) ریال</MudText>
                                                                @if (item.Pricing.FreeCount != null && item.Pricing.FreeCount > 0)
                                                                {
                                                                    <MudText Typo="Typo.caption">@item.Pricing.FreeCount عدد رایگان میباشد</MudText>
                                                                }
                                                            </MudStack>
                                                            <MudNumericField Variant="Variant.Outlined" Margin="Margin.Dense" T="int" Min="item.Pricing.FreeCount??0" Value="@(_ActiveBundle.Features.FirstOrDefault(x=>x.Id == item.Id) == null ? (item.Pricing.FreeCount??0) : _ActiveBundle.Features.FirstOrDefault(x=>x.Id == item.Id)!.RequestCount!.Value)" ValueChanged="(x)=> CountableFeatureChanged(item,x)" />
                                                        </MudStack>
                                                    }
                                                    else
                                                    {
                                                        <MudText Typo="Typo.caption">به تعداد نا محدود رایگان میباشد</MudText>
                                                    }
                                                    break;
                                                default:
                                                    break;
                                            }
                                        </MudStack>
                                    </MudStack>
                                    @if (!String.IsNullOrEmpty(item.Description))
                                    {
                                        <MudText Class="mt-2" Typo="Typo.caption">@item.Description</MudText>
                                    }
                                </MudPaper>
                            }
                        </MudPaper>
                    </MudItem>
                }
            </MudGrid>

        }
        @if (_BundleDurations != null)
        {
            <MudGrid>
                <MudItem xs="12" md="6">
                    <MudStack AlignItems="AlignItems.Center" Class="pa-10">
                        @if (_BundleDuration != null && CalculatePrice() > 0)
                        {
                            <MudText>جمع مبلغ پراختی : @CalculatePrice().Separate3Digits() ريال</MudText>
                            <BaseButton Color="Color.Primary" Size="Size.Large" Variant="Variant.Filled" OnClick="Activate">تایید و تهیه اشتراک</BaseButton>
                        }
                        else
                        {
                            <MudChip ReadOnly T="string" Color="Color.Primary" Variant="Variant.Outlined" Label="true" Text="این قابلیت به صورت رایگان فعال میباشد" />
                        }
                    </MudStack>
                </MudItem>
                <MudItem xs="12" md="6">
                    <MudText Typo="Typo.h4" Class="my-3">مدت زمان اشتراک</MudText>
                    <MudToggleGroup T="BundleDurationDTO" Color="Color.Primary" @bind-Value="_BundleDuration">
                        @foreach (var item in _BundleDurations)
                        {
                            <MudToggleItem Value="item">
                                <MudStack Justify="Justify.Center" Spacing="1">
                                    <MudText>@item.Description</MudText>
                                    <MudText Typo="Typo.caption">
                                        @if (item.Discount.Percent > 0)
                                        {
                                            <text>@item.Discount.Percent % تخفیف</text>
                                        }
                                    </MudText>
                                </MudStack>
                            </MudToggleItem>
                        }
                    </MudToggleGroup>
                </MudItem>
            </MudGrid>

        }


    </MudCardContent>
</MudCard>

