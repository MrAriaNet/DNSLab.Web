@using DNSLab.Web.DTOs.Repositories.Ticket
@using DNSLab.Web.Enums
@attribute [Route(AllRoutes.AllTickets)]
@attribute [Authorize(Roles = AuthorizeRoles.Admin)]

<MudCard Elevation="0">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h5">تیکت ها</MudText>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary" EndIcon="@Icons.Material.Rounded.Add" OnClick="AddTicket">ثبت تیکت جدید</MudButton>
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        <MudDataGrid T="TicketDTO" Items="_Tickets?.OrderByDescending(x=>x.CreateDate)" Dense Hover Bordered Outlined Loading="_IsLoading">
            <NoRecordsContent>
                <MudAlert Severity="Severity.Warning" ContentAlignment="HorizontalAlignment.Center" NoIcon>
                    <MudText Typo="Typo.caption">تا به حال هیچ تیکتی ثبت نشده است!</MudText>
                </MudAlert>
            </NoRecordsContent>
            <Columns>
                <PropertyColumn Property="x=>x.Title" Title="عنوان" />
                <PropertyColumn Property="x=>x.Status" Title="وضعیت" SortBy="x=>x.Status!.Id">
                    <CellTemplate>
                        <MudSelect T="TicketStatusEnum" Variant="Variant.Text" Value="(TicketStatusEnum)context.Item.Status!.Id" Margin="Margin.Dense" ValueChanged="x=> OnStatusChanged(context.Item , x)">
                            @foreach (TicketStatusEnum item in Enum.GetValues(typeof(TicketStatusEnum)))
                            {
                                <MudSelectItem T="TicketStatusEnum" Value="item">@item</MudSelectItem>
                            }
                        </MudSelect>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x=>x.CreateDate" Title="تاریخ ثبت">
                    <CellTemplate>
                        <MudText>@context.Item.CreateDate.ToLocalTime().ToPersianDateTime().EnglishToPersianNumbers()</MudText>
                    </CellTemplate>
                </PropertyColumn>
                <TemplateColumn>
                    <CellTemplate>
                        <MudStack Row Justify="Justify.FlexEnd">
                            <MudMenu Dense Size="Size.Small" Icon="@Icons.Material.Filled.MoreVert" DropShadow AnchorOrigin="Origin.BottomLeft" TransformOrigin="Origin.TopRight">
                                <MudMenuItem Href="@(AllRoutes.TicketMessages+"/"+context.Item.Id)" Icon="@Icons.Material.Rounded.Message">مشاهده</MudMenuItem>
                            </MudMenu>
                        </MudStack>
                    </CellTemplate>
                </TemplateColumn>
            </Columns>
        </MudDataGrid>
    </MudCardContent>
</MudCard>