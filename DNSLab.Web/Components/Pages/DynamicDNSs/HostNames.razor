@using DNSLab.Web.DTOs.Repositories.Record
@attribute [Route(AllRoutes.DDNSHostNames)]
@attribute [Authorize]
<SeoProvider Title="هاست نیم ها" />

<MudText Typo="Typo.h1" Align="Align.Center">هاست‌نِیم ها</MudText>
<MudText Class="mt-5 mb-10" Align="Align.Center">
    از هاست‌نِیم به عنوان یک روش برای تعریف یک اسم به آی‌‌پی استفاده میشود
    <MudFlexBreak />
    برای شروع با توجه به دامنه مد نظر خودتون بر روی دکمه افزودن هاست‌نیم کلیک کنید
</MudText>

@if (_AllRecords == null)
{

}
else
{
    @foreach (var zone in _AllRecords.OrderByDescending(x => x.Item2.Count()))
    {
        <MudCard Class="mb-2" Elevation="0">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h5">@zone.Item1.Name</MudText>
                </CardHeaderContent>
                <CardHeaderActions>
                    <MudButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary" EndIcon="@DNSLabIcons.Add" OnClick="()=> NewRecord(zone.Item1)">افزودن هاست نِیم</MudButton>
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent>
                @if (zone.Item2.Count() > 0)
                {
                    <MudDataGrid T="BaseRecordDTO" Items="zone.Item2.OrderBy(x=>x.Name)" Dense Hover Elevation="0">
                        <NoRecordsContent>
                            <NoRecordFound />
                        </NoRecordsContent>
                        <Columns>
                            <PropertyColumn Property='x=>$"{x.Name}.{zone.Item1.Name}"' Title="نام" />
                            <PropertyColumn Property="x=>x.Type" Title="نوع">
                                <CellTemplate>
                                    <MudChip T="string" Color="Color.Primary" Size="Size.Small" Label="true">@context.Item.Type</MudChip>
                                </CellTemplate>
                            </PropertyColumn>
                            <PropertyColumn Property="x=>x.TTL" Title="TTL" />
                            <PropertyColumn Property="x=>x.RData" Title="مقدار" CellClass="dnslab-ltr" Sortable="false">
                                <CellTemplate>
                                    <MudText Typo="Typo.body2">
                                        @switch (context.Item.Type)
                                        {
                                            case Enums.RecordTypeEnum.A:
                                                <text>IPv4 : @(context.Item.CastTo<ARecordDTO>()!.IPv4Address)</text>
                                                break;
                                            case Enums.RecordTypeEnum.AAAA:
                                                <text>IPv6 : @(context.Item.CastTo<AAAARecordDTO>()!.IPv6Address)</text>
                                                break;
                                            case Enums.RecordTypeEnum.CNAME:
                                                <text>CName : @(context.Item.CastTo<CNAMERecordDTO>()!.CName)</text>
                                                break;
                                            default:
                                                break;
                                        }
                                    </MudText>
                                </CellTemplate>
                            </PropertyColumn>
                            <PropertyColumn Property="x=>x.LastModified" Title="آخرین تغییر">
                                <CellTemplate>
                                    <MudText Typo="Typo.body2">@(context.Item.LastModified.HasValue ? context.Item.LastModified.Value.ToLocalTime().ToPersianDateTime() : "بدون تغییر")</MudText>
                                </CellTemplate>
                            </PropertyColumn>
                            <PropertyColumn Property="x=>x.Disable" Title="وضعیت">
                                <CellTemplate>
                                    @if (context.Item.Disable)
                                    {
                                        <MudChip T="string" Color="Color.Warning" Size="Size.Small" Label="true">غیرفعال</MudChip>
                                    }
                                    else
                                    {
                                        <MudChip T="string" Color="Color.Success" Size="Size.Small" Label="true">فعال</MudChip>
                                    }
                                </CellTemplate>
                            </PropertyColumn>
                            <PropertyColumn Property="x=>x.Comment" Title="یادداشت" />
                            <TemplateColumn StickyLeft>
                                <CellTemplate>
                                    <MudStack Row Justify="Justify.FlexEnd" Spacing="1">
                                        <BaseIconButton OnClick="()=> CopyLink(context.Item, zone.Item1)" DropShadow="false" Size="Size.Small" Variant="Variant.Filled" Icon="@DNSLabIcons.Copy" />
                                        <BaseIconButton Href="@(AllRoutes.RecordsHistory+"?RecordId="+context.Item.Id)" DropShadow="false" Size="Size.Small" Variant="Variant.Filled" Icon="@DNSLabIcons.History" />
                                        <BaseIconButton OnClick="()=> EditRecord(context.Item, zone.Item1)" DropShadow="false" Size="Size.Small" Variant="Variant.Filled" Icon="@DNSLabIcons.Edit" />
                                        <BaseIconButton OnClick="()=> DisableRecord(context.Item, zone.Item1.Name)" DropShadow="false" Size="Size.Small" Variant="Variant.Filled" Icon="@(context.Item.Disable? Icons.Material.Filled.ToggleOn : Icons.Material.Outlined.ToggleOff)" />
                                        <BaseIconButton OnClick="()=> DeleteRecord(context.Item, zone.Item1.Name)" DropShadow="false" Color="Color.Error" Size="Size.Small" Variant="Variant.Filled" Icon="@DNSLabIcons.Delete" />
                                    </MudStack>
                                </CellTemplate>
                            </TemplateColumn>
                        </Columns>
                    </MudDataGrid>
                }
            </MudCardContent>
        </MudCard>
    }
}