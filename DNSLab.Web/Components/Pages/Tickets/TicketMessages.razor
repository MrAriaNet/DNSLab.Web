@using DNSLab.Web.Utilities
@attribute [Route(AllRoutes.TicketMessages + "/{TicketId:guid}")]
@attribute [Authorize]
<SeoProvider Title="جزئیات تیکت" />

<MudText Typo="Typo.h1" Align="Align.Center" Class="mb-10">جزئیات تیکت</MudText>

@if (_Ticket != null)
{
    <MudCard Elevation="0">
        <MudCardHeader>
            <CardHeaderContent >
                <MudText Typo="Typo.h3">موضوع : @_Ticket?.Title</MudText>
            </CardHeaderContent>
            <CardHeaderActions>
                <BaseButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary" DropShadow="false" StartIcon="@DNSLabIcons.Back" Href="@AllRoutes.MyTickets">بازگشت</BaseButton>
            </CardHeaderActions>
        </MudCardHeader>
        <MudCardContent>
            @foreach (var item in _Ticket.Messages.OrderBy(x => x.CreateDate))
            {
                <MudCard Elevation="0">
                    <MudCardHeader Class="pb-0">
                        <CardHeaderAvatar>
                            @((MarkupString)ProfileImageCreator.GenerateSVG(item.User!.Id, 40))
                        </CardHeaderAvatar>
                        <CardHeaderContent>
                            <MudStack Row Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
                                <MudText Class="mb-2">@item.User!.FullName</MudText>
                                <MudText Typo="Typo.body2">تاریخ ثبت : @item.CreateDate.ToLocalTime().ToPersianDateTime()</MudText>
                            </MudStack>
                        </CardHeaderContent>
                    </MudCardHeader>
                    <MudCardContent>
                        <MudText HtmlTag="pre" Style="white-space: pre-wrap;">@item.Message</MudText>
                    </MudCardContent>
                </MudCard>
            }

            <MudTextField T="string" Lines="3" Label="متن پیام" Class="mt-2" Variant="Variant.Outlined" @bind-Value="_TicketMessage.Message" />
        </MudCardContent>
        <MudCardActions>
            <BaseButton Variant="Variant.Filled" Color="Color.Primary" OnClick="SendMessage">ارسال پیام</BaseButton>
        </MudCardActions>
    </MudCard>
}