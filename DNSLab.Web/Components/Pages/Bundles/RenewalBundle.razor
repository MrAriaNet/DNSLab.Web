@using DNSLab.Web.DTOs.Repositories.Bundle
@attribute [Route(AllRoutes.Renewal)]
@attribute [Authorize]
<SeoProvider Title="تمدید اشتراک" />

<MudText Typo="Typo.h1" Align="Align.Center">تمدید اشتراک</MudText>
<MudText Class="mt-5 mb-10" Align="Align.Center">در این بخش میتوانید اشتراک های در حال منقضی یا منقضی شده را تمدید نمایید</MudText>

<MudCard Elevation="0">
    <MudCardHeader>
        <CardHeaderContent>
        </CardHeaderContent>
        <CardHeaderActions>
            <MudButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary" EndIcon="@DNSLabIcons.Subscriptions" Href="@AllRoutes.Bundle">تهیه اشتراک جدید</MudButton>
            <MudButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary" EndIcon="@DNSLabIcons.Wallet" Href="@AllRoutes.MyWallet">کیف پول</MudButton>
        </CardHeaderActions>
    </MudCardHeader>
    <MudCardContent>
        @if (_UserBundles != null)
        {
            <MudDataGrid T="UserBundleDTO" Items="_UserBundles.OrderByDescending(x=>x.EndDate)" Dense Hover Outlined FixedHeader SortMode="SortMode.None" Striped Loading="_Loading">
                <NoRecordsContent>
                    <NoRecordFound />
                </NoRecordsContent>
                <Columns>
                    <TemplateColumn Title="قابلیت ها">
                        <CellTemplate>
                            @foreach (var feature in context.Item.Bundle.Features)
                            {
                                <MudStack Row AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                                    @switch (feature.Feature.Type)
                                    {
                                        case Enums.FeatureTypeEnum.Countable:
                                            <MudText Typo="Typo.caption">@feature.Feature.Name : </MudText>
                                            <MudText Typo="Typo.caption" Class="ml-1">@feature.Count</MudText>
                                            break;
                                        case Enums.FeatureTypeEnum.Toggle:
                                            <MudText Typo="Typo.caption">@feature.Feature.Name</MudText>
                                            <MudIcon Size="Size.Small" Color="Color.Success" Icon="@DNSLabIcons.Check" />
                                            break;
                                        default:
                                            break;
                                    }
                                </MudStack>
                                <MudFlexBreak />
                            }
                        </CellTemplate>
                    </TemplateColumn>
                    <TemplateColumn Title="مبغ(ريال)">
                        <CellTemplate>
                            <MudText>@context.Item.TotalPrice.Separate3Digits()</MudText>
                        </CellTemplate>
                    </TemplateColumn>
                    <PropertyColumn Property="x=>x.Duration.Description" Title="مدت" />
                    <PropertyColumn Property="x=>x.StartDate.ToLocalTime().ToPersianDateTime()" Title="زمان شروع" />
                    <PropertyColumn Property="x=>x.EndDate.ToLocalTime().ToPersianDateTime()" Title="زمان پایان" />
                    <TemplateColumn>
                        <CellTemplate>
                            <BaseButton DropShadow="false" Variant="Variant.Filled" Size="Size.Small" OnClick="()=>Renewal(context.Item)">تمدید اشتراک (@CalculatePrice(context.Item))</BaseButton>
                        </CellTemplate>
                    </TemplateColumn>
                </Columns>
            </MudDataGrid>
        }
    </MudCardContent>
</MudCard>