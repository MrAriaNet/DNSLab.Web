@using DNSLab.Web.DTOs.Repositories.Record
@using DNSLab.Web.Enums
@attribute [Route(AllRoutes.RecordsHistory + "/{RecordId:guid}")]
@attribute [Authorize]
<SeoProvider Title="رکورد های دامنه" />

<MudCard Elevation="0">
    <MudCardHeader>
        <CardHeaderContent>
            <MudText Typo="Typo.h5">تاریخچه تغییرات</MudText>
        </CardHeaderContent>
    </MudCardHeader>
    <MudCardContent>
        <MudDataGrid T="RecordChangeDTO" Items="_RecordChanges?.OrderByDescending(x=>x.TimeStamp)" Loading="_Loading" Dense Hover Outlined>
            <NoRecordsContent>
                <MudAlert Dense Severity="Severity.Warning" ContentAlignment="HorizontalAlignment.Center" NoIcon>
                    <MudText Typo="Typo.body2">تا به حال هیچ تغییری ثبت نشده است!</MudText>
                </MudAlert>
            </NoRecordsContent>
            <Columns>
                <PropertyColumn Property="x=>x.TimeStamp.ToPersianDateTime()" Title="زمان" StickyRight />
                <PropertyColumn Property="x=>x.OperationId" Title="عملیات">
                    <CellTemplate>
                        @switch ((RecordChangeOperationEnum)context.Item.OperationId)
                        {
                            case RecordChangeOperationEnum.Insert:
                                <MudChip T="string" Color="Color.Success" Size="Size.Small" Label="true">ثبت</MudChip>
                                break;
                            case RecordChangeOperationEnum.Delete:
                                <MudChip T="string" Color="Color.Error" Size="Size.Small" Label="true">حذف</MudChip>
                                break;
                            case RecordChangeOperationEnum.Update:
                                <MudChip T="string" Color="Color.Info" Size="Size.Small" Label="true">ویرایش</MudChip>
                                break;
                            case RecordChangeOperationEnum.Disable:
                                <MudChip T="string" Color="Color.Warning" Size="Size.Small" Label="true">فعالیت</MudChip>
                                break;
                        }
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x=>x.PreviousData" Title="قبل" CellClass="dnslab-ltr" Sortable="false">
                    <CellTemplate>
                        @if (context.Item.PreviousData is not null)
                        {
                            <MudText Typo="Typo.body2">
                                @switch (context.Item.PreviousData.Type)
                                {
                                    case Enums.RecordTypeEnum.A:
                                        <text>IPv4 : @(context.Item.PreviousData.CastTo<ARecordDTO>()!.IPv4Address)</text>
                                        break;
                                    case Enums.RecordTypeEnum.AAAA:
                                        <text>IPv6 : @(context.Item.PreviousData.CastTo<AAAARecordDTO>()!.IPv6Address)</text>
                                        break;
                                    case Enums.RecordTypeEnum.TXT:
                                        <text>Text Data : @(context.Item.PreviousData.CastTo<TXTRecordDTO>()!.TextData)</text>
                                        break;
                                    case Enums.RecordTypeEnum.MX:
                                        <text>Exchange : @(context.Item.PreviousData.CastTo<MXRecordDTO>()!.Exchange)</text>
                                        <MudFlexBreak />
                                        <text>Preference : @(context.Item.PreviousData.CastTo<MXRecordDTO>()!.Preference)</text>
                                        break;
                                    case Enums.RecordTypeEnum.CNAME:
                                        <text>CName : @(context.Item.PreviousData.CastTo<CNAMERecordDTO>()!.CName)</text>
                                        break;
                                    default:
                                        break;
                                }
                            </MudText>
                        }
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x=>x.CurrentData" Title="بعد" CellClass="dnslab-ltr" Sortable="false">
                    <CellTemplate>
                        @if (context.Item.CurrentData is not null)
                        {
                            <MudText Typo="Typo.body2">
                                @switch (context.Item.CurrentData.Type)
                                {
                                    case Enums.RecordTypeEnum.A:
                                        <text>IPv4 : @(context.Item.CurrentData.CastTo<ARecordDTO>()!.IPv4Address)</text>
                                        break;
                                    case Enums.RecordTypeEnum.AAAA:
                                        <text>IPv6 : @(context.Item.CurrentData.CastTo<AAAARecordDTO>()!.IPv6Address)</text>
                                        break;
                                    case Enums.RecordTypeEnum.TXT:
                                        <text>Text Data : @(context.Item.CurrentData.CastTo<TXTRecordDTO>()!.TextData)</text>
                                        break;
                                    case Enums.RecordTypeEnum.MX:
                                        <text>Exchange : @(context.Item.CurrentData.CastTo<MXRecordDTO>()!.Exchange)</text>
                                        <MudFlexBreak />
                                        <text>Preference : @(context.Item.CurrentData.CastTo<MXRecordDTO>()!.Preference)</text>
                                        break;
                                    case Enums.RecordTypeEnum.CNAME:
                                        <text>CName : @(context.Item.CurrentData.CastTo<CNAMERecordDTO>()!.CName)</text>
                                        break;
                                    default:
                                        break;
                                }
                            </MudText>
                        }
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x=>x.IsProcessed" Title="وضعیت">
                    <CellTemplate>
                        @if (context.Item.IsProcessed)
                        {
                            <MudIcon Icon="@DNSLabIcons.Check" Size="Size.Small" Color="Color.Success" />
                        }
                        else
                        {
                            <MudIcon Icon="@DNSLabIcons.Refresh" Size="Size.Small" Color="Color.Info" />
                        }
                    </CellTemplate>
                </PropertyColumn>
            </Columns>
        </MudDataGrid>
    </MudCardContent>
</MudCard>
